angular.module("myApp.apiInterfaceSrv",[]).service("apiInterfaceSrv",function($rootScope,productsSrv,modalSrv){var apiInterface={items:[],fetch:function(){productsSrv.fetch(function(dataResponse){apiInterface.items=dataResponse.data})},add:function(){modalSrv.show("components/modal/modal-add-product-tpl.html",null,"lm",function(model){var product=_.pick(model,"title","description","price","img");productsSrv.add(product,function(responseData){apiInterface.items.unshift(responseData.data)})})},update:function(item){productsSrv.update(item,function(){$rootScope.common.unsaved=!1})},"delete":function(item){modalSrv.show("components/modal/modal-remove-product-tpl.html",null,"sm",function(model){productsSrv["delete"]({id:item.id},function(dataResponse){dataResponse.status&&(apiInterface.items=_.without(apiInterface.items,_.findWhere(apiInterface.items,{id:item.id})),$timeout(function(){alert("element: "+item.title+" został usunięty z powodu:\n"+model.reason)}))})})}};return apiInterface});
angular.module("myApp.commonSrv",[]).service("commonSrv",function(){return{access:!1,base:"http://js.edu.pl/api/"}});
angular.module("myApp.services",["myApp.apiInterfaceSrv","myApp.commonSrv"]);
angular.module("myApp.directives",["myApp.input","myApp.product","myApp.menu","myApp.upload"]);
angular.module("myApp.filters",[]).filter("startFromFtr",function(){return function(input,start){return input&&input.length?input.slice(start):void 0}});
angular.module("myApp.modal",[]).service("modalSrv",function($modal){return{show:function(tpl,itemData,size,callback){var myModal=$modal.open({templateUrl:tpl,size:size,resolve:{model:function(){return itemData}},controller:function($scope,model){$scope.model=model,$scope.ok=function(form){form.$valid?myModal.close($scope):$scope.errorMsg=!0},$scope.cancel=function(){myModal.dismiss("cancel")}}});myModal.result.then(function(modalData){callback(modalData)},function(info){console.log(info)})}}});
angular.module("myApp.request",["myApp.products-request","myApp.shop-request"]);
angular.module("myApp.products-request",["ngResource"]).service("productsSrv",function($resource){return $resource("http://js.edu.pl/api/news/:id",{id:"@id"},{fetch:{method:"GET"},fetchItem:{method:"GET"},update:{method:"PUT"},add:{method:"POST"},"delete":{method:"DELETE"}})});
angular.module("myApp.shop-request",[]).service("shopSrv",function($resource){return $resource("data/:shopId.json",{},{fetch:{method:"GET"}})});
angular.module("myApp.input",[]).directive("inputDctv",function(){return{restrict:"E",templateUrl:"components/directives/input/input-tpl.html",transclude:!0,scope:{type:"@",required:"=",model:"=",errorMsg:"="}}});
angular.module("myApp.menu",[]).directive("menuDctv",function($http,modalSrv,$location,$cookieStore){return{restrict:"E",transclude:!0,templateUrl:"components/directives/menu/menu-tpl.html",controller:function($scope){$scope.login=function(){modalSrv.show("components/directives/menu/login-tpl.html",null,"sm",function(model){$http.post($scope.$root.common.base+"login/",{login:model.login,pass:model.pass}).success(function(responseData){responseData.status&&($scope.$root.common.access=!0,$scope.$root.common.user=responseData.user,$cookieStore.put("logged",responseData.user),alert("zalogowano pomyślnie"))})})}}}});
angular.module("myApp.product",[]).directive("productItemDctv",function($timeout){return{restrict:"E",templateUrl:"components/directives/product/product-item-tpl.html",scope:{data:"=",update:"&","delete":"&"},controller:function($scope){$scope.dataCopy=angular.copy($scope.data),$scope.$watch("dataCopy.price",function(newVal,oldVal){angular.equals(newVal,oldVal)||($scope.$root.common.unsaved=!0,$timeout.cancel($scope.isTimeOut),$scope.isTimeOut=$timeout(function(){$scope.data.price=+$scope.dataCopy.price,$scope.update({item:$scope.data})},1e3))})},link:function(){}}});
angular.module("myApp.upload",["angularFileUpload"]).directive("uploadDctv",function(){return{restrict:"E",transclude:!0,scope:{data:"=",errorMsg:"="},templateUrl:"components/directives/upload/upload-tpl.html",controller:function($scope,$upload){$scope.$watch("files",function(){if($scope.files)for(var i=0;i<$scope.files.length;i++){var file=$scope.files[i];$scope.upload=$upload.upload({url:$scope.$root.common.base+"file.php",data:{myObj:$scope.myModelObj},file:file}).progress(function(evt){console.log("progress: "+parseInt(100*evt.loaded/evt.total)+"% file :"+evt.config.file.name)}).success(function(data,status,headers,config){console.log("file "+config.file+"is uploaded successfully. Response: "+data),$scope.data=data.file})}})}}});
angular.module("myApp.views",["myApp.contact","myApp.products","myApp.shop"]);
angular.module("myApp.contact",[]).config(function($routeProvider){$routeProvider.when("/contact",{templateUrl:"views/contact/contact-tpl.html",controller:"ContactCtrl"})}).controller("ContactCtrl",function($scope){$scope.sendMessage=function(){$scope.contactForm.$valid?($scope.sentMsg=!0,$scope.errorMsg=!1,$scope.user={}):$scope.errorMsg=!0}});
"use strict";angular.module("myApp.products",["ngRoute"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/products",{templateUrl:"views/products/products-tpl.html",controller:"ProductsCtrl"})}]).controller("ProductsCtrl",function($scope,apiInterfaceSrv){$scope.apiInterfaceSrv=apiInterfaceSrv,apiInterfaceSrv.fetch(),$scope.paginationSettings={currentPage:1,itemsPerPage:5,maxSize:5}});
angular.module("myApp.shop",["ngMap"]).config(function($routeProvider){$routeProvider.when("/shops/:shopId",{templateUrl:"views/shop/shop-tpl.html",controller:"ShopCtrl"})}).controller("ShopCtrl",function($scope,$routeParams,shopSrv){function setMarker(data){var marker=new google.maps.Marker({title:data.name}),lat=data.position.lat,lng=data.position.lng,loc=new google.maps.LatLng(lat,lng);marker.setPosition(loc),marker.setMap($scope.map)}$scope.$on("mapInitialized",function(){shopSrv.fetch({shopId:$routeParams.shopId},function(responseData){$scope.data=responseData.data,$scope.map.setZoom(6),$scope.map.setOptions({draggable:!1,zoomControl:!0,scrollwheel:!0,disableDoubleClickZoom:!0}),setMarker($scope.data)})})});
"use strict";angular.module("myApp",["ngRoute","ngCookies","ui.bootstrap","myApp.contact","myApp.directives","myApp.views","myApp.services","myApp.request","myApp.modal","myApp.filters"]).config(function($routeProvider,$resourceProvider,$httpProvider){$routeProvider.otherwise({redirectTo:"/view1"}),$resourceProvider.defaults.stripTrailingSlashes=!1,$httpProvider.defaults.withCredentials=!0}).run(function($rootScope,commonSrv,$cookieStore){$rootScope.common=commonSrv,$cookieStore.get("logged")&&($rootScope.common.access=!0,$rootScope.common.user=$cookieStore.get("logged")),$rootScope._=_});